var getLocation=function(){$("#msg").html("<div class='alert alert-transparent' role='alert'><strong><img width='50px' height='50px' src='_library/images/icons/radar.gif'/><br>Carregando localização...</strong></div>").show().slideDown("slow");if(navigator.geolocation){var timeoutVal=10 * 100 * 100;navigator.geolocation.getCurrentPosition(showSucesso,showErro,{enableHighAccuracy:true,timeout:timeoutVal,maximumAge:0});}else{$("#msg").html("<div class='alert alert-danger' role='alert'><strong>Geolocalização não é suportado por este navegador!</strong></div>").show().slideDown("slow").delay(6000).slideUp("slow");}}
var showSucesso=function(position){var latitude=position.coords.latitude;var longitude=position.coords.longitude;var geocoder=new google.maps.Geocoder();geocoder.geocode({"location": new google.maps.LatLng(latitude,longitude)},function(results,status){if(status==google.maps.GeocoderStatus.OK){var AddressAccount = results[0].formatted_address;}var idUser=[],hash;var hashes=window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');for(var i = 0; i < hashes.length; i++){hash=hashes[i].split('#');idUser.push(hash[0]);idUser[hash[0]]=hash[1];if(idUser == 'https://linkedon.000webhostapp.com/app.html'){location.href='index.html'; return false;}}
$.ajax({url:'_models/model.InsertPositionCoords.php',dataType:'html',type:'POST',data:{'latitude':latitude,'longitude':longitude,'idUser':idUser,'AddressAccount':AddressAccount},success:function(retorno){if(retorno=='error_insert_bd'){$("#msg").html('<div class="alert alert-danger" role="alert"><strong>Não foi possivel obter a Localização!<strong></div>').show().slideDown("slow").delay(6000).slideUp("slow");}else $("#msg").html('<div class="alert alert-success" role="alert"><strong>Localização obtida com Sucesso!<strong></div>').show().slideDown("slow").delay(6000).slideUp("slow");$("#carregando").html('<p class="font_white">Carregando Mapa com sua localização!<br>Por favor aguarde...</p>').show().slideDown("slow").delay(7500).slideUp("slow");getLocationMap(retorno);$("#alertGps").hide();},error:function(){$("#msg").html("<div class='alert alert-danger'><strong>Erro na Função InsertPositionCoords!</strong></div>").show().slideDown("slow").delay(6000).slideUp("slow");}});return idUser;});}
var showErro=function(erro){switch(erro.code){case erro.PERMISSION_DENIED:$("#msg").html("<div class='alert alert-danger'><strong>Usuário negou o pedido de Geolocalização!</strong></div>").show().slideDown("slow").delay(6000).slideUp("slow");alert('E necessario que compartilhe sua localização!');break;case erro.POSITION_UNAVAILABLE:$("#msg").html("<div class='alert alert-danger'><strong>A posição não está disponível!</strong></div>").show().slideDown("slow").delay(6000).slideUp("slow");break;case erro.TIMEOUT:$("#msg").html("<div class='alert alert-danger'><strong>Expirou o pedido de localização pelo sistema!</strong></div>").show().slideDown("slow").delay(6000).slideUp("slow");alert('Ative seu GPS!');break;case erro.UNKNOWN_ERROR:$("#msg").html("<div class='alert alert-danger'><strong>Um erro desconhecido ocorreu!</strong></div>").show().slideDown("slow").delay(6000).slideUp("slow");break;}}